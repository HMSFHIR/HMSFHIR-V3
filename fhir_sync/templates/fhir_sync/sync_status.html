{% extends "Patients/main.html" %}
{% load static %}

{% block PageName %}
    FHIR Sync Status
{% endblock %}

{% block content %}
<section class="operations">
    <h2>üîÅ FHIR Sync Status</h2>
    {% if server_connected %}
        <p style="color:green;">‚úÖ Successfully connected to the FHIR server.</p>

        <!-- üîò Sync Now Button -->
        <form method="post" action="{% url 'manual_sync' %}">
            {% csrf_token %}
            <button type="submit" class="sync-button">üîÅ Sync Now</button>
        </form>
    {% else %}
        <p style="color:red;">‚ö†Ô∏è Unable to connect to the FHIR server. Please check the server status.</p>
    {% endif %}
</section>

<h3>‚è≥ Pending Resources</h3>
<table class="patients-table">
    <thead>
        <tr>
            <th>Resource Type</th>
            <th>Resource ID</th>
            <th>Status</th>
            <th>Queued At</th>
        </tr>
    </thead>
    <tbody>
        {% for resource in pending_tasks %}
        <tr>
            <td>{{ resource.resource_type }}</td>
            <td>{{ resource.resource_id }}</td>
            <td>{{ resource.status }}</td>
            <td>{{ resource.created_at }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">‚úÖ No pending resources</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>‚úÖ Synced Resources</h3>
<table class="patients-table">
    <thead>
        <tr>
            <th>Resource Type</th>
            <th>Resource ID</th>
            <th>Status</th>
            <th>Synced At</th>
        </tr>
    </thead>
    <tbody>
        {% for resource in synced_tasks %}
        <tr>
            <td>{{ resource.resource_type }}</td>
            <td>{{ resource.resource_id }}</td>
            <td>{{ resource.status }}</td>
            <td>{{ resource.created_at }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">‚ö†Ô∏è No synced resources yet</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
