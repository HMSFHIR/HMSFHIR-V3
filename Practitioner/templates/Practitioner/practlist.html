{% extends "autht/main.html" %}

{% block PageName %}Practitioners{% endblock PageName %}
{% block title %}Practitioners{% endblock%}

{% load static %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'Practitioner/practlist.css' %}">
<script src="{% static 'js/practlistsearch.js' %}" ></script>

<style>
    .access-restricted {
        background: #fef3c7;
        border: 1px solid #fbbf24;
        color: #92400e;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
    }
</style>

<div class="page-header">
    <div>
        <h1 class="page-title">Practitioners</h1>
        <p class="page-subtitle">Manage hospital practitioners and their information</p>
    </div>
    {% if user.user_type == 'admin' %}
        <div class="operations">
            <a href="{% url 'NewPractitioner' %}" class="add-practitioner-btn">
                <i class="fas fa-plus"></i>
                Add Practitioner
            </a>
        </div>
    {% else %}
        <div></div>
    {% endif %}
</div>

<div class="filters-section">
    <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search practitioners..." id="searchInput">
    </div>
</div>

<div class="table-container">
    <div class="table-header">
        <div class="table-title">All Practitioners</div>
        <div class="table-count">{{ practitioners|length }} practitioner{{ practitioners|length|pluralize }}</div>
    </div>
    
    {% if practitioners %}
        <table class="practitioners-table">
            <thead>
                <tr>
                    <th>Practitioner</th>
                    <th>Role</th>
                    <th>Contact</th>
                    <th>Department</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for practitioner in practitioners %}
                    <tr>
                        <td>
                            <div class="practitioner-id">{{ practitioner.practitioner_id }}</div>
                            <div class="practitioner-name">{{ practitioner.user.first_name }} {{ practitioner.user.last_name }}</div>
                        </td>
                        <td>
                            <span class="role-badge role-{% if practitioner.user_type == 'doctor' %}doctor{% elif practitioner.user_type == 'nurse' %}nurse{% elif practitioner.user_type == 'admin' %}admin{% elif practitioner.user_type == 'IT' %}admin{% else %}specialist{% endif %}">
                                {{ practitioner.user_type|title }}
                            </span>
                        </td>
                        <td>
                            <div class="contact-info">{{ practitioner.phone|default:"No phone" }}</div>
                            <div class="contact-info">{{ practitioner.user.email }}</div>
                        </td>
                        <td>{{ practitioner.department }}</td>
                        <td>
                            <div class="action-buttons">
                                {% if user.user_type == 'admin' %}
                                    <!-- Full access for admin -->
                                    <a href="{% url 'EditPractitioner' practitioner.practitioner_id %}" class="btn btn-edit">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </a>
                                    <form method="post" action="{% url 'DeletePractitioner' practitioner.practitioner_id %}" style="display:inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-delete" onclick="return confirm('Delete practitioner {{ practitioner.user.first_name }} {{ practitioner.user.last_name }}?')">
                                            <i class="fas fa-trash"></i>
                                            Delete
                                        </button>
                                    </form>
                                {% elif user.user_type == 'IT' %}
                                    <!-- Limited access for IT - edit only, no delete -->
                                    <a href="{% url 'EditPractitioner' practitioner.practitioner_id %}" class="btn btn-edit">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </a>

                                {% else %}
                                    <!-- View only for other roles -->
                                    <span class="access-restricted" title="Practitioner management restricted for {{ user.user_type }} users">
                                        View Only
                                    </span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <i class="fas fa-user-md"></i>
            <h3>No practitioners found</h3>
            <p>
                {% if user.user_type == 'admin' %}
                    Get started by adding your first practitioner to the system.
                {% else %}
                    No practitioners in the system.
                {% endif %}
            </p>
            {% if user.user_type == 'admin' %}
                <a href="{% url 'NewPractitioner' %}" class="add-practitioner-btn">
                    <i class="fas fa-plus"></i>
                    Add First Practitioner
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}